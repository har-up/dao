## 创业的扩展
在合适的时间和状态下去扩展。
## 编码时间的扩展
在创业公司中，一切都在不断的变化，如果你已经到了害怕修改代码的地步，就意味着需要在编码实践上进行扩展，以适应增长的需要。
应对不断增长的代码库和开发团队的最重要的四个编码实践:
### 自动化测试
拥有自动化测试，在修改代码后可以运行测试看是否通过来确保代码是否可以正常工作。
自动化测试有：单元测试，集成测试，冒烟测试，验收测试，性能测试
- 单元测试  验证的是单独的一个小单元的功能，通常是验证一个单独的函数，最多也就是一个类
- 集成测试  每个单元能够各自正确的运行，并不能保证多个单元组合到一起能够正确的运行，所以需要集成测试，集成测试的覆盖范围非常广泛，从测试若干个类和模块的交互，到
  测试整个子系统如何一起工作

- 验收测试  从客户的角度验证产品的行为，回答“代码是否正确解决问题”的问题。如果创业公司编写出能完美通过所有单元测试和集成测试的正确代码，实际上却并不是
  客户想要的，这其实就是最大的浪费。

- 性能测试  验证数以千计的并发用户，验证系统在面对繁重的负载和故障时的稳定性和响应能力。

测试驱动开发(TDD)在编写实现代码之前就编写测试代码

应该测试什么  测试是很重要，它们是快速实现高质量软件最强有力的手段之一，但是测试并不是没成本的，我们需要花时间去编写测试，在代码发生变化时需要更新测试。
在创业公司中，早期跳过测试也可能是一种可以接受的取舍，因为你并不知道产品是否会成功，如果花时间在一个用户不接受的产品上未免太浪费了时间
### 代码分离
产品的设计必须简单，才能适应人类大脑的局限性。代码也是如此，如果我们在一个地方放了太多的代码，就会让程序员的记忆不堪重负，代码库也会变得更加难以理解。你拥有
的代码越多，前进的速度就越慢，缺陷密度会显著增长。对于代码库来说，最糟糕的就是规模的扩大，所以我么应该努力让代码的规模尽可能的减小。一方面可以把尽可能多的工作委派
给基础代码之外的开源和商业函数库来实现，另一方面可以使用编码风格简洁，减少样板文件引用和重复的编程语言来实现。

学会将代码分离多个“片段”， 通过这种方式我们可以一次只考虑一个片段，暂时忽略其他片段，这就是所谓的抽象。
信息隐藏意味着抽象应该比其背后的细节更加简单
可组合性意味着可以把抽象组合起来，从而得到新的抽象。
编程中的抽象：
- 接口与模块  大多数编程语言都允许定义接口
- 版本化构件  将功能进行分割，对每个分割后的子功能进行单独的版本化构件
- 服务 把某类功能放到一个进程后面，通过消息去和进程通信而非进行函数调用。缺点是操作的复杂性，需要一些机制去实现服务发现，负载君合，分析调用曲线等；错误处理，
  调用远程服务时可能会失败，可能是网络问题引起，也可能是服务已经停止了；性能开销，远程调用说话的时间成本要比本地函数调用多几个数量级；I/O,增加操作开销，引发
  性能上的问题；向后兼容性,我们无法删除或重命名一个服务的API,哪怕是API中的一个单独的参数，因为客户端很可能仍然在使用老版本，意味着我们无法简单的对一个服务的API
  进行重构，而是必须进行版本的更替，并可能要在很长一段时间去维护老版本，从而增加维护的开销。一般来说服务就蕴含着大量的开销，所以除非没有其他选择，最好还是
  避免使用服务。
### 代码评审
如果整洁的代码就是让其他程序员可以更容易的理解你的代码，那么实现这一点的最好做法就是把代码展示给其他程序员看。让代码被其他人评审是捕捉bug最有效率的手段之一。
研究表明，通过代码评审可以将100行代码中的4.5个代码减少的只有0.82个bug。错误率下降80%以上。
- 设计评审  在进行一个大型的新项目之前，先做出设计并从团队中手机反馈是比较好的做法。我们要保持设计评审轻量化，对他人优化，确保所有人都参与进来：高级工程师应该
  让他们的设计接受初级工程师的评审，反之亦然。
- 结对编程  让两名程序员一起编程，一个观察，负责评审代码，一个编写代码。并且两人定期交换角色
- 提交前评审  一旦完成了一段代码的编写和测试，我们就要准备好提交代码，先把代码提交给团队进行最终评审是好的做法。提交前评审可以让每一个都有机会看到我们所
  构建的东西，提出问题并找到错误。
- 静态分析  使用自动化的工具去检查代码也是好的做法，检测代码风格，检测重复，和没有使用的代码。对一些复杂的指标进行计算并找出需要重构的代码。

代码评审是每一个公司都应该应用的必备时间，但要更好的实时也要遵循若干指南。
首先，为代码的每个部分指定一个所有人，所有人并不是唯一允许修改这部分代码的人，但他们有责任知道这段代码如何工作，并且要保持它运行。这意味着他们要决定
可以对代码做什么样的修改，谁可以进行评审，必须强制执行什么编码标准，合适可以部署代码。
其次，需要提奖将代码评审指南写下来，营造良好的代码评审文化，这些指南应该包含期望掌握的事项的备忘录，比如代码是否容易阅读，是否遵循团队的编码约定
是否包含测试。代码评审不是炫耀自己的知识，取消他人的代码或者责怪他人，它是一种学习的手段，能让团队中的所有人变得更加出色。
三：保持小规模的评审，鼓励开发人员进行小修改提交，增量式的提交，这也是减少bug，合并冲突和后期集成问题出现概率的好方法
### 文档
文档对于代码规模的扩展和开发团队都是必不可少的，即便团队只有一个人也是如此。
编写文档就像编写自动化测试，可以显著提升代码质量。如果你强迫自己从用户的角度去看待项目，将会得到更好地设计。如果你化一个小时用文字去描述正确的解决方案
可以节省代码编写错误解决方案所需要的一个星期。
- 书面文档  书面文档有Readme文件，教程，参考手册和项目网站构成。Readme文件时代码中最重要的文档，它概括项目的任务，描述项目的作用，展示例子并解释如何开始
  使用，如何为项目做出贡献，以及从哪里获取更多的信息

- 代码文档  注释是存在于代码中的书面文档，整洁的代码不需要很多注释，我们需要变大的几乎所有东西都应该由代码本身去传达，如果遇到一些无法理解的代码，解决的办法
  并不是添加解释性的注释，而是对代码进行重构，直到它能够以自己的术语被理解。

- 社区文档

## 性能的扩展
程序员容易痴迷与性能，时间复杂度和可扩展性，会赞美一些“网络级”和处理“大数据”的公司，但现实是，对于大多数创业公司而言，这些都不是最重要的
我们的时间应该花在能提高开发团队效率的工具和实践上。而不是让服务器跑得更快。只有在产品已经有了一定的规模，性能可能成为瓶颈后，这个才是需要考虑的问题。
当我们有幸需要考虑性能问题时，性能的改进是以以下两个步骤的迭代过程：
### 测量
考虑算法的时间复杂度和空间复杂度
### 优化
在发现问题后，我们应该如何考虑去解决性能问题：
- 分治  把一个问题划分成许多更小的问题，并在多cpu和服务器上分别去解决这些问题
- 缓存  可以提前执行任务并保存结果，这样就不用在需要的时候再计算，只需要从存储中获取提前计算好的值就可以，例如数据库缓存，非规范化架构，分布式缓存，CDN,cookies,
  记忆化和动态编程算法。
- 懒惰  除非绝对必要，否则可以先推迟一些任务，之后再做例如延迟加载网页的部分内容，只在滚动到该区域之后再加载，数据库中的乐观锁定。
- 近似正确性  得到一个近似正确的值比得到准确的答案能减少很多工作量的情况下，可以考虑使用近似值，例如最终一致性，HyperLogLog，降低持久性保证，尽力消息传递
- 异步  在等待计算结果的时候不采用锁定和阻塞的方法，而是继续执行任务，在计算完成的时候再通知，例如非阻塞I/O,时间循环，无锁数据结构
- 抖动与随机化  尝试将负载均匀扩散，从而避免出现峰值和热点，例如缓存有效期限随机化，负载均衡算法，键分区算法
- 节流  拒绝某些计算，以防拖慢其他计算，例如服务器限速请求或去除请求路径中缓慢服务器
- 冗余  剔除一次以上的相同计算并返回最快完成的计算，例如分布式系统中的备份或多面请求，应对故障的冗余服务器
- 协同定位  把物理上更接近的东西放到一起以降低延迟，例如CDN，全世界的多数据中心，将关联的服务器放在同一机架上
- 更快的硬件  又称垂直扩展，更快的cpu,更多的内存，更多的cpu缓存，固态硬盘，更快的网络，在内存中执行计算而不是在磁盘上计算，在cpu缓存中计算代替在内存中计算
- 更快的算法  找到可以减少工作量的算法，例如用二分搜索代替线性搜索，用快速排序代替冒泡排序。

实现这些策略前，我们可以先进性一些估算，判断哪种策略对我们可能最为划算，当然，也只有实际实现和测量后才知道确切的答案。但实现的成本是昂贵的，我们可以使用节本
的算术，排除一些明显不好的选择，节省许多时间
